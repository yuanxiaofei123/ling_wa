<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8" />
    <title>采购</title>
    <meta name="baidu-site-verification" content="4vNEpUr1Eg" />
    <meta name="keywords" content="领蛙,领带蛙,杭州领带蛙网络科技有限公司,智能优选零食,零食,领蛙零食,企业文化"/>
    <meta name="description" content="领蛙,领带蛙,杭州领带蛙网络科技有限公司,智能优选零食,零食,领蛙零食,企业文化"/>
    <!--允许全屏-->
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <meta content="yes" name="apple-touch-fullscreen" />
    <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, user-scalable=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="grey"/>
    <meta name="screen-orientation" content="portrait">
    <meta name="x5-orientation" content="portrait">
    <link rel="stylesheet" type="text/css" href="./static/css/reset.css" media="all"> 
    <link rel="stylesheet" type="text/css" href="./static/css/lingwa.css" media="all">
    <link href="" rel="apple-touch-icon-precomposed">
    <script type="text/javascript" src="./static/js/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="./static/js/rem.js"></script>
</head>
<body style="background-color:#f7f7f7;">
    <div class="push_content">
        <div class="search">
        <form  name="itemForm" id="form" action="" method="get">
            <input type="text" name="itemName" placeholder="请输入商品名" id="sec" value="可乐">
            <input type="hidden" name="shopid" value="">
            <input type="submit" style="display:none">
            <span class="cl" id="cl">x</span>
        </form>
            <span class="cancel" style="display:none;color:#000;" id="cancel" >取消</span>
        </div>
        <div class="good_list">
                <!-- 商品 -->
                <div class="goods" level-id="33" data-pid="657" cat-id="24"><img data-original="http://assets.lingwa.com.cn/images/item/953ce7ce-9194-4f3d-a394-4cbc6743c2ae.jpg" class="goods_img" src="http://assets.lingwa.com.cn/images/item/953ce7ce-9194-4f3d-a394-4cbc6743c2ae.jpg" style="display: block;"><div class="ziti">EDO纤麦饼干31.6g</div><div class="goods_price"><span class="so">￥1.2</span><span>￥<span style="text-decoration: none;">1.00</span></span></div><div class="goods_spec"><span>31.6g/包</span><span>X<span>20</span></span></div><div class="button_a"><img src="static/images/caigou_sup.png" class="sup" style="display:none;"><input type="text" name="" class="shu_input" value="0" style="display:none;" readonly="readonly"><img src="static/images/caigou_add.png" class="add"></div></div><div class="goods" level-id="33" data-pid="653" cat-id="24"><img data-original="http://assets.lingwa.com.cn/images/item/953ce7ce-9194-4f3d-a394-4cbc6743c2ae.jpg" class="goods_img" src="http://assets.lingwa.com.cn/images/item/953ce7ce-9194-4f3d-a394-4cbc6743c2ae.jpg" style="display: block;"><div class="ziti">EDO纤麦饼干31.6g</div><div class="goods_price"><span class="so">￥1.2</span><span>￥<span style="text-decoration: none;">2.00</span></span></div><div class="goods_spec"><span>31.6g/包</span><span>X<span>1</span></span></div><div class="button_a"><img src="static/images/caigou_sup.png" class="sup" style="display:none;"><input type="text" name="" class="shu_input" value="0" style="display:none;" readonly="readonly"><img src="static/images/caigou_add.png" class="add"></div></div><div class="goods" level-id="33" data-pid="652" cat-id="24"><img data-original="http://assets.lingwa.com.cn/images/item/953ce7ce-9194-4f3d-a394-4cbc6743c2ae.jpg" class="goods_img" src="http://assets.lingwa.com.cn/images/item/953ce7ce-9194-4f3d-a394-4cbc6743c2ae.jpg" style="display: block;"><div class="ziti">EDO纤麦饼干31.6g</div><div class="goods_price"><span class="so">￥1.2</span><span>￥<span style="text-decoration: none;">1.00</span></span></div><div class="goods_spec"><span>31.6g/包</span><span>X<span>12</span></span></div><div class="button_a"><img src="static/images/caigou_sup.png" class="sup" style="display:none;"><input type="text" name="" class="shu_input" value="0" style="display:none;" readonly="readonly"><img src="static/images/caigou_add.png" class="add"></div></div>
                <div class="goods" level-id="33" data-pid="652" cat-id="24"><img data-original="http://assets.lingwa.com.cn/images/item/953ce7ce-9194-4f3d-a394-4cbc6743c2ae.jpg" class="goods_img" src="http://assets.lingwa.com.cn/images/item/953ce7ce-9194-4f3d-a394-4cbc6743c2ae.jpg" style="display: block;"><div class="ziti">EDO纤麦饼干31.6g</div><div class="goods_price"><span class="so">￥1.2</span><span>￥<span style="text-decoration: none;">1.00</span></span></div><div class="goods_spec"><span>31.6g/包</span><span>X<span>12</span></span></div><div class="button_a"><img src="static/images/caigou_sup.png" class="sup" style="display:none;"><input type="text" name="" class="shu_input" value="0" style="display:none;" readonly="readonly"><img src="static/images/caigou_add.png" class="add"></div></div>
                <div class="goods" level-id="33" data-pid="652" cat-id="24"><img data-original="http://assets.lingwa.com.cn/images/item/953ce7ce-9194-4f3d-a394-4cbc6743c2ae.jpg" class="goods_img" src="http://assets.lingwa.com.cn/images/item/953ce7ce-9194-4f3d-a394-4cbc6743c2ae.jpg" style="display: block;"><div class="ziti">EDO纤麦饼干31.6g</div><div class="goods_price"><span class="so">￥1.2</span><span>￥<span style="text-decoration: none;">1.00</span></span></div><div class="goods_spec"><span>31.6g/包</span><span>X<span>12</span></span></div><div class="button_a"><img src="static/images/caigou_sup.png" class="sup" style="display:none;"><input type="text" name="" class="shu_input" value="0" style="display:none;" readonly="readonly"><img src="static/images/caigou_add.png" class="add"></div></div>
                <div class="goods" level-id="33" data-pid="652" cat-id="24"><img data-original="http://assets.lingwa.com.cn/images/item/953ce7ce-9194-4f3d-a394-4cbc6743c2ae.jpg" class="goods_img" src="http://assets.lingwa.com.cn/images/item/953ce7ce-9194-4f3d-a394-4cbc6743c2ae.jpg" style="display: block;"><div class="ziti">EDO纤麦饼干31.6g</div><div class="goods_price"><span class="so">￥1.2</span><span>￥<span style="text-decoration: none;">1.00</span></span></div><div class="goods_spec"><span>31.6g/包</span><span>X<span>12</span></span></div><div class="button_a"><img src="static/images/caigou_sup.png" class="sup" style="display:none;"><input type="text" name="" class="shu_input" value="0" style="display:none;" readonly="readonly"><img src="static/images/caigou_add.png" class="add"></div></div>
                <div class="goods" level-id="33" data-pid="652" cat-id="24"><img data-original="http://assets.lingwa.com.cn/images/item/953ce7ce-9194-4f3d-a394-4cbc6743c2ae.jpg" class="goods_img" src="http://assets.lingwa.com.cn/images/item/953ce7ce-9194-4f3d-a394-4cbc6743c2ae.jpg" style="display: block;"><div class="ziti">EDO纤麦饼干31.6g</div><div class="goods_price"><span class="so">￥1.2</span><span>￥<span style="text-decoration: none;">1.00</span></span></div><div class="goods_spec"><span>31.6g/包</span><span>X<span>12</span></span></div><div class="button_a"><img src="static/images/caigou_sup.png" class="sup" style="display:none;"><input type="text" name="" class="shu_input" value="0" style="display:none;" readonly="readonly"><img src="static/images/caigou_add.png" class="add"></div></div>
                <div class="goods" level-id="33" data-pid="652" cat-id="24"><img data-original="http://assets.lingwa.com.cn/images/item/953ce7ce-9194-4f3d-a394-4cbc6743c2ae.jpg" class="goods_img" src="http://assets.lingwa.com.cn/images/item/953ce7ce-9194-4f3d-a394-4cbc6743c2ae.jpg" style="display: block;"><div class="ziti">EDO纤麦饼干31.6g</div><div class="goods_price"><span class="so">￥1.2</span><span>￥<span style="text-decoration: none;">1.00</span></span></div><div class="goods_spec"><span>31.6g/包</span><span>X<span>12</span></span></div><div class="button_a"><img src="static/images/caigou_sup.png" class="sup" style="display:none;"><input type="text" name="" class="shu_input" value="0" style="display:none;" readonly="readonly"><img src="static/images/caigou_add.png" class="add"></div></div>
        </div>
         <!-- 购物车 -->
        <div class="cart_bg" style="display:none;"></div>
        <div class="ca_head" style="bottom:-9.27rem;"> 
                <span style="margin-left:.18rem;">购物车</span>
                <span class="cart_close" onclick="close_item(this);">清空</span>
        </div>
        <div class="cart" style="bottom:-8.97rem;">
            
            <ul class="cart_list">
                
            </ul>
        </div>
    </div>
       
    <div class="caigou_footer" style="z-index:999;">
        <div class="bi" id="sure">
            <span class="number" style="display:none;">0</span>
            <span class="bianli_num" style="display:none;">￥<span>0.00</span></span>
        </div>
        
        <div class="pay">去结算</div>
    </div>
</body>
<script type="text/javascript">
    $(function(){
       $('input[name="itemName"]').css("width","69%");
       $("#cancel").show(); 
    })
    // 点击 取消按钮出现
    $('input[name="itemName"]').click(function() {
        $('input[name="itemName"]').css("width","69%");
        $("#cancel").show();
        $('input[name="itemName"]').focus();
    });
    $("#cancel").click(function() {
        $('input[name="itemName"]').css("width","87%");
        $('input[name="itemName"]').val("");
        $("#cl").css("visibility","hidden");
        $('input[name="itemName"]').focus();
        $("#cancel").hide();
    });
var touchmove;
$(document).on( "touchstart", function() {
  touchmove = false;
});
  $(document).on( "touchmove", function() {
  touchmove = true;
});
// 购物车外加
$('.add').on('touchend',function(){
    //var doing = $(this);
    var sp = $(this).parent().siblings('.goods_spec').find('span').eq(1).find('span').text();
        //找到底部购物车的圆圈
        var number =$(this).parent().parent().parent().parent().siblings('.caigou_footer').find('.bi .number');
        $(number).css('display','block');

        $(this).parent().parent().parent().parent().siblings('.caigou_footer').find('.bi .bianli_num').css('display','block');
        $(this).siblings('.sup').show();
        $(this).siblings('.shu_input').show();
        //当前点击的商品data-id
        var n_id = $(this).parent().parent().attr('data-pId');
        //获取商品数量
        var caigou_add = $(this).siblings('.shu_input').val();
        if (sp.length>0) {
            //如果这个商品要成倍的卖出
            var have = parseInt($(this).siblings('.shu_input').val())+ parseInt(sp);
            $(this).siblings('.shu_input').val(have);
            $(this).siblings('.shu_input').attr('value',have);
            var nu = parseInt(number.text())+parseInt(sp);
            $(number).text(nu);
        }else{
            //否则加1
            var par = parseInt(caigou_add)+1;
            $(this).siblings('.shu_input').val(par);
            $(this).siblings('.shu_input').attr('value',par);
            var nu = parseInt(number.text())+1;
            $(number).text(nu);
        }
        setnum();
        setTotal();
        //添加商品到购物车
        var html='';
        var $goods=$(this).parent().parent();
        var pid = $goods.attr('data-pId');
        var price =$goods.find('.goods_price span').eq(1).find('span').text();
        var num = $goods.find('.button_a .shu_input').val();
        var goods_name =$goods.find('.ziti').text();
        if($('.cart_list li').length){//如果购物车列表里面有li标签 也就是有商品
        $('.cart_list li').each(function (){//遍历每个商品
            if(n_id ==$(this).attr('data-pId')){//如果商品的这个id和点击的商品id一样
                $('.carLi'+pid).remove(); //把这个商品先删除掉 后面在重新添加
            }
        });
        //不管上面遍历结果如果 先添加当前选中商品到购物车 这里不用考虑是否商品有重合的，因为商品如果重合，那么必然是点击了第二次，但是在第二次时候，上面的遍历会去掉重合的
        html += '<li data-pId="'+pid+'"  class="carLi'+pid+'"><span class="cart_name">'+goods_name+'</span><span style="display:none;">X<span>'+sp+'</span></span><span class="cart_price">￥<span>'+price+'</span></span><img src="static/images/caigou_sup.png" class="reduce"><input type="" name="" class="shu_input" value="'+num+'" readonly="readonly"><img src="static/images/caigou_add.png" class="plus"></li>';
        $('.cart_list').append(html);
        }else {//如果购物车是空的，直接加个商品进去
        html += '<li data-pId="'+pid+'"  class="carLi'+pid+'"><span class="cart_name">'+goods_name+'</span><span style="display:none;">X<span>'+sp+'</span></span><span class="cart_price">￥<span>'+price+'</span></span><img src="static/images/caigou_sup.png" class="reduce"><input type="" name="" class="shu_input" value="'+num+'" readonly="readonly"><img src="static/images/caigou_add.png" class="plus"></li>';
        $('.cart_list').append(html);
        }
        return;
    
});
//购物车外减
$('.sup').on('touchend',function(){
    var doing = $(this);
    var s=$(doing).parent().parent().attr('data-pId');
        var sp = $(doing).parent().siblings('.goods_spec').find('span').eq(1).find('span').text();
        var caigou_add = $(doing).siblings('.shu_input').val();
        var number = $(doing).parent().parent().parent().parent().parent().siblings('.caigou_footer').find('.bi .number');
        if (sp.length>0) {
            var have = parseInt($(doing).siblings('.shu_input').val()) - parseInt(sp);
            $(doing).siblings('.shu_input').val(have);
            $(doing).siblings('.shu_input').attr('value',have);
            var nu = parseInt(number.text()) - parseInt(sp);
            $(number).text(nu);
             if (have <= 0) {
                $(doing).siblings('.shu_input').val(0);
                }
        }else{
           var par = parseInt(caigou_add)-1;
           $(doing).siblings('.shu_input').val(par);
           $(doing).siblings('.shu_input').attr('value',par); 
           var nu = parseInt(number.text())-1;
           $(number).text(nu);
        }
        if (par <= 0) {
            $(doing).siblings('.shu_input').val(0);     
         }
        if (nu <=0) {
             $(number).text(0);
         }
        setnum();
        setTotal();
        //当商品数量减到0时  就隐藏
        if ($(doing).siblings('.shu_input').val()== 0) {
            $(doing).hide();
            $(doing).siblings('.shu_input').hide();
        }
        var html='';
        var $goods=$(doing).parent().parent();
        var pid = $goods.attr('data-pId');
        var price =$goods.find('.goods_price span').eq(1).find('span').text();
        var num = $goods.find('.button_a .shu_input').val();
        var goods_name =$goods.find('.ziti').text();
        if($('.cart_list li').length){//如果购物车列表里面有li标签 也就是有商品
        $('.cart_list li').each(function (){//遍历每个商品
            if(s ==$(this).attr('data-pId')){//如果商品的这个id和点击的商品id一样
                $('.carLi'+pid).remove(); //把这个商品先删除掉 后面在重新添加
            }
        });
        //不管上面遍历结果如果 先添加当前选中商品到购物车 这里不用考虑是否商品有重合的，因为商品如果重合，那么必然是点击了第二次，但是在第二次时候，上面的遍历会去掉重合的
        html += '<li data-pId="'+pid+'"  class="carLi'+pid+'"><span class="cart_name">'+goods_name+'</span><span style="display:none;">X<span>'+sp+'</span></span><span class="cart_price">￥<span>'+price+'</span></span><img src="static/images/caigou_sup.png" class="reduce"><input type="" name="" class="shu_input" value="'+num+'" readonly="readonly"><img src="static/images/caigou_add.png" class="plus"></li>';
        $('.cart_list').append(html);
        }else {//如果购物车是空的，直接加个商品进去
        html += '<li data-pId="'+pid+'"  class="carLi'+pid+'"><span class="cart_name">'+goods_name+'</span><span style="display:none;">X<span>'+sp+'</span></span><span class="cart_price">￥<span>'+price+'</span></span><img src="static/images/caigou_sup.png" class="reduce"><input type="" name="" class="shu_input" value="'+num+'" readonly="readonly"><img src="static/images/caigou_add.png" class="plus"></li>';
        $('.cart_list').append(html);
        }
        //如果购物车里面 有商品的数量为0 就删除掉
        if (num == 0) {
            $('.carLi'+pid).remove();
        }
        return;
    
});
$('.push_content').on('touchend',function(e){
    if (touchmove) {
        return;
    }
    var op = e.target;
    if (op.className == "plus") {
        //购物车内单品数量
        var p_id = $(op).parent().attr('data-pId');
        var pl_val = $(op).siblings('span').eq(1).find('span').text();
        alert(pl_val);
        //判断如果购物车内 有单品数量 就累加 如果没有就默认＋1
        if (pl_val.length>0){
            var pl_inp = parseInt($(op).siblings('.shu_input').val())+parseInt(pl_val);
            $(op).siblings('.shu_input').val(pl_inp);
        }else{
            var pl_only = parseInt($(op).siblings('.shu_input').val())+1;
            $(op).siblings('.shu_input').val(pl_only);
        }
        var goods_wai = $(op).parent().parent().parent().siblings('.caigou_right').find('.good_list .goods');
        $('.good_list .goods').each(function(){
            if (p_id == $(this).attr('data-pId')) {
                //购物车内的当前点击商品的数量
                var now_amout = $(op).siblings('.shu_input').val();
                $(this).find('.button_a .shu_input').val(now_amout);
                setnum();
                setTotal();
               
            }
        });
        return;
    }
    if (op.className == "reduce") {
        var p_id = $(op).parent().attr('data-pId');
        //购物车内单品数量
        var pl_val = $(op).siblings('span').eq(1).find('span').text();
        //判断如果购物车内 有单品数量 就累减 如果没有就默认-1
        if (pl_val.length>0){
           var pl_inp = parseInt($(op).siblings('.shu_input').val())-parseInt(pl_val);
           $(op).siblings('.shu_input').val(pl_inp);
           if (pl_inp <= 0){
               $(op).siblings('.shu_input').val(0); 
           } 
        }else{
           var pl_only = parseInt($(op).siblings('.shu_input').val())-1;
           $(op).siblings('.shu_input').val(pl_only);
           if (pl_only <= 0) {
            $(op).siblings('.shu_input').val(0);
           }
        }
        var goods_wai = $(op).parent().parent().parent().siblings('.caigou_right').find('.good_list .goods');
        $('.good_list .goods').each(function(){
            if (p_id == $(this).attr('data-pId')) {
                //购物车内的当前点击商品的数量
                var now_amout = $(op).siblings('.shu_input').val();
                $(this).find('.button_a .shu_input').val(now_amout);
                if ($(this).find('.button_a .shu_input').val()==0) {
                    $(this).find('.button_a .shu_input').hide();
                    $(this).find('.button_a .sup').hide()
                }
                setnum();
                setTotal();
            }
        });
        if ($(op).siblings('.shu_input').val() == 0) {
            $(op).parent().remove();
        }
        return;
    }
})

function setnum(){
    var s = 0;
    var v = 0;
    $(".goods .button_a .shu_input").each(function(){
        v += parseInt($(this).val());

    });
    $('.number').text(v);
}
function close_item(object){
   if ($(object).parent().siblings('.cart').find('.cart_list li').length>0){
        if (confirm("确定清空商品吗？")){
           $(object).parent().siblings('.cart').find('.cart_list li').remove();
           $('.good_list .goods').each(function(){
                $(this).find('.button_a .shu_input').val(0).hide();
                $(this).find('.button_a .sup').hide();
            });
            $('.number').text(0);
               $('.number').css('display','none');
               $('.bianli_num').find('span').text(0);
               $('.bianli_num').css('display','none'); 
               $('.bi').attr('id','sure');
               $(".cart").animate({bottom:"-8.97rem"},200);
               $(".ca_head").animate({bottom:"-9.27rem"},200);
               $('.cart_bg').fadeOut();
           }
        
}
           else{
                $('.bi').attr('id','sure');
                $(".cart").animate({bottom:"-8.97rem"},200);
                $(".ca_head").animate({bottom:"-9.27rem"},200);
                $('.cart_bg').fadeOut();
                 
           }
       return;
     }
// // 计算金额
function setTotal(){
    var s = 0.00;
    $('.goods').each(function(){
        s+=parseFloat($(this).find('.goods_price span').eq(1).find('span').text())*parseInt($(this).find('.button_a .shu_input').val());
    });
    $(".bianli_num span").html(s.toFixed(2));
}

$('.bi').on("touchend",function(){
    if (touchmove) {
        return;
    }
  if($(this).attr('id') == 'sure'){

    if(! $('.cart_bg ').is(":animated")){ 
        //判断元素是否处于动画状态
        if (! $('.cart').is(":animated")) {
            $(this).attr('id','');
            $(".cart").animate({bottom:"1.1rem"},200);
            $('.ca_head').animate({bottom:"9.27rem"},200); 
            $('.cart_bg').fadeIn();
            return false;
        }
 
  }
  }else{
       $(this).attr('id','sure');
       $(".cart").animate({bottom:"-8.97rem"},200);
       $('.ca_head').animate({bottom:"-9.27rem"},200); 
       $('.cart_bg').fadeOut(); 
  }       
});
</script>
</html>
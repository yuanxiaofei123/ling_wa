<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8" />
    <title>便利店测试</title>
    <meta name="baidu-site-verification" content="4vNEpUr1Eg" />
    <meta name="keywords" content="领蛙,领带蛙,杭州领带蛙网络科技有限公司,智能优选零食,零食,领蛙零食,企业文化"/>
    <meta name="description" content="领蛙,领带蛙,杭州领带蛙网络科技有限公司,智能优选零食,零食,领蛙零食,企业文化"/>
    <!--允许全屏-->
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <meta content="yes" name="apple-touch-fullscreen" />
    <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, user-scalable=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="grey"/>
    <meta name="screen-orientation" content="portrait">
    <meta name="x5-orientation" content="portrait">
    <link rel="stylesheet" type="text/css" href="./static/css/reset.css" media="all"> 
    <link rel="stylesheet" type="text/css" href="./static/css/lingwa.css" media="all">
    <link href="" rel="apple-touch-icon-precomposed">
    <script type="text/javascript" src="./static/js/jquery-1.7.2.min.js"></script>
</head>
<body>
    <div class="shop_list_content">
        <div class="shop_list_search">
        <form  name="itemForm" id="form" action="/convenient/shop_consumeList.htm" method="get">
            <input type="text" name="itemName" id="sec" placeholder="昵称或姓名">
            <span class="cl" id="cl">x</span>
            <span class="cancel" style="display:none" id="cancel">取消</span>
        </form>
        </div>
        <div class="spend_content">
            <div class="spending_list" id="1">
                <p class="message">
                    <!-- 微信头像 -->
                    <img src="static/images/qq.jpg">
                    <span>郑旭东11</span>
                </p>
                <p class="foods">
                    <!-- 商品信息 -->
                    <span class="foods_01">
                        <span class="foods_name">
                            <span>耶米熊雪花干吃汤圆</span>
                            <span class="foods_price">￥0.50</span>
                            <span class="foods_num">x12</span>
                        </span>
                    </span>

                    <span class="foods_01">
                        <span class="foods_name">
                            <span>可口可乐</span>
                            <span class="foods_price">￥1.50</span>
                            <span class="foods_num">x2</span>
                        </span>
                    </span>

                    <span class="foods_01">
                        <span class="foods_name">
                            <span>可口可乐</span>
                            <span class="foods_price">￥1.50</span>
                            <span class="foods_num">x2</span>
                        </span>
                    </span>

                    <span class="foods_01">
                        <span class="foods_name">
                            <span>可口可乐</span>
                            <span class="foods_price">￥1.50</span>
                            <span class="foods_num">X2</span>
                        </span>
                    </span>
                </p>
                <p class="sup">
                    <!-- 总计 -->
                    <!-- <span class="sup_list">
                        <span>06-18</span>
                        <span class="sup_data">15:22:00</span> -->
                        <!-- 如果有限时补贴 -->
                        <!-- <span style="float:right;color:green;margin-right:-.1rem;">（限时补贴￥2.90）</span> -->
                        <!-- 如果有红包 -->
                        <!-- <span style="float:right;color:red;margin-right:-.1rem;">（红包￥2.90）</span>
                        <span class="fr">￥2.30</span>
                    </span> -->
                    <!-- 如果有红包或者限时 -->
                    <span class="sup_list" style="position: relative;padding-bottom: .4rem;">
                        <span>06-18</span>
                        <span class="sup_data">15:22:00</span>
                        <!-- 如果有限时补贴 -->
                        <span style="float:right;color:green;margin-right:-.1rem;">（限时补贴￥2.90）</span>
                        <!-- 如果有红包 -->
                        <span style="position: absolute; color:red;margin-right:-.1rem;right: 0;top: .6rem;">（红包￥2.90）</span>
                        <span class="fr">￥2.30</span>
                    </span>
                </p>
                <div class="delete"></div>
            </div>
            <div class="spending_list" id="2 ">
                <p class="message">
                    <!-- 微信头像 -->
                    <img src="static/images/qq.jpg">
                    <span>郑旭东</span>
                </p>
                <p class="foods">
                    <!-- 商品信息 -->
                    <span class="foods_01">
                        <span class="foods_name">
                            <span>耶米熊雪花干吃汤圆</span>
                            <span class="foods_price">￥0.50</span>
                            <span class="foods_num">X12</span>
                        </span>
                    </span>

                    <span class="foods_01">
                        <span class="foods_name">
                            <span>可口可乐</span>
                            <span class="foods_price">￥1.50</span>
                            <span class="foods_num">X2</span>
                        </span>
                    </span>
                </p>
                <p class="sup">
                    <!-- 总计 -->
                    <span class="sup_list">
                        <span>06-18</span>
                        <span class="sup_data">15:22:00</span>
                        <span class="fr">￥2.30</span>
                    </span>
                </p>
                <div class="delete"></div>
            </div>
            <div class="spending_list" id="3">
                <p class="message">
                    <!-- 微信头像 -->
                    <img src="static/images/qq.jpg">
                    <span>郑旭东</span>
                </p>
                <p class="foods">
                    <!-- 商品信息 -->
                    <span class="foods_01">
                        <span class="foods_name">
                            <span>耶米熊雪花干吃汤圆</span>
                            <span class="foods_price">￥0.50</span>
                            <span class="foods_num">X12</span>
                        </span>
                    </span>

                    <span class="foods_01">
                        <span class="foods_name">
                            <span>可口可乐</span>
                            <span class="foods_price">￥1.50</span>
                            <span class="foods_num">X2</span>
                        </span>
                    </span>
                </p>
                <p class="sup">
                    <!-- 总计 -->
                    <span class="sup_list">
                        <span>06-18</span>
                        <span class="sup_data">15:22:00</span>
                        <span class="fr">￥2.30</span>
                    </span>
                </p>
                <!-- 退款 -->
                <div class="delete">
                    <span class="del" >退款</span>
                </div>
            </div>
            <div class="spending_list" id="3">
                <p class="message">
                    <!-- 微信头像 -->
                    <img src="static/images/qq.jpg">
                    <span>郑旭东</span>
                </p>
                <p class="foods">
                    <!-- 商品信息 -->
                    <span class="foods_01">
                        <span class="foods_name">
                            <span>耶米熊雪花干吃汤圆</span>
                            <span class="foods_price">￥0.50</span>
                            <span class="foods_num">X12</span>
                        </span>
                    </span>

                    <span class="foods_01">
                        <span class="foods_name">
                            <span>可口可乐</span>
                            <span class="foods_price">￥1.50</span>
                            <span class="foods_num">X2</span>
                        </span>
                    </span>
                </p>
                <p class="sup">
                    <!-- 总计 -->
                    <span class="sup_list">
                        <span>06-18</span>
                        <span class="sup_data">15:22:00</span>
                        <span class="fr">￥2.30</span>
                    </span>
                </p>
                <!-- 退款 -->
                <div class="delete">
                    <span class="s" >退款</span>
                </div>
            </div>
        </div>
        <p class="sw"  id="loading" style="display:none;">正在加载更多数据.....</p>
    </div>
            </div>
        </div>
    </div>
    <div class="footer">
       <a href="" class="home ">首页<i></i><b></b></a>
       <a href="" class="home ">采购<i></i><b></b></a>
       <a href="" class="home live">消费记录<i></i><b></b></a>
       <a href="" class="home ">店铺管理<b></b></a>
   </div>
   
</body>
</html>
<script type="text/javascript">
$(function(){
    var spend = $('.spending_list');
    for (var i = 0; i < spend.length; i++) {
        var del = $(spend[i]).find('.del').length;
        var ss = $(spend[i]).find('.s').length;
        if (del||ss) {
            return false;
        }else{
           $(spend[i]).find('.sup').addClass('wi'); 
        }
    }
});
window.onscroll = function (){
      if (Math.abs($(document).scrollTop() >= $(document).height()-$(window).height())) {
        $("#loading").css('display','block');
      }
}
 //给每个退款按钮注册点击事件
 $(".spend_content").on("touchend",function(e){
    // e.target是被点击的元素!
    if (e.target && e.target.nodeName =="SPAN") {
        var classes = e.target.className.split(" ");
        for (var s = 0; s < classes.length; s++) {
                if (classes[s] == "del") {
                    if (confirm("确定要退款吗？")) 
                    {
                        $(e.target).replaceWith('<span class="s">已退款</span>');

                    }
                
                }
        }
        
        
    }
}); 
 // function sId(){
 //    $(".del").on("touchend",function(){
 //        var a = $(this).parent().parent();
 //        var id = $(a).attr("id");
 //        if (confirm("确认退款吗？")) {
            
 //        }
 //    });
 // }
window.onscroll = function(){
     if (Math.abs($(document).scrollTop() >= $(document).height()-$(window).height())) {
        $("#loading").css("display","block");
        var s = {"status":200,"msg":"OK","data":{"pageNum":1,"pageSize":8,"size":4,"startRow":1,"endRow":4,"total":559,"pages":70,"list":[{"id":"BLD20160704125240000026","totalPrice":100,"buyerId":null,"shopId":null,"buyerName":"Mr.S","shopName":null,"createdTime":1467607960000,"status":1,"headImgurl":"http://wx.qlogo.cn/mmopen/ISVtUfMsITkt5GaXcHD7fJxNN1YNCJc5giaxlfiaiaSFMrE8Gn8t6vXsqTrgXia3icx7AcRNRUOiaxQ0vQVyTbyyJqFgftN0VCBRoy/0","sourcing":null,"consume":null,"month":null,"shopOrderItems":[{"id":955,"orderId":null,"itemId":null,"itemName":"1元棒冰","num":1,"price":100}]},{"id":"BLD20160704124754000025","totalPrice":180,"buyerId":null,"shopId":null,"buyerName":"头上长树","shopName":null,"createdTime":1467607674000,"status":1,"headImgurl":"http://wx.qlogo.cn/mmopen/EpaDQa6cD4BBXsCAENh2icmUIwPr0tU2JuVlAmLicJjrPVaXByRA0AwicdXqYV6qMyZW3vTDBbaC9YPMvqBGToujiaRJauc4otib1/0","sourcing":null,"consume":null,"month":null,"shopOrderItems":[{"id":954,"orderId":null,"itemId":null,"itemName":"董小姐薯片","num":2,"price":90}]},{"id":"BLD20160704124605000023","totalPrice":1860,"buyerId":null,"shopId":null,"buyerName":"YanCheng","shopName":null,"createdTime":1467607565000,"status":1,"headImgurl":"http://wx.qlogo.cn/mmopen/PiajxSqBRaEJ6E1cicgwGFPJyWMfICxicjbUFFbFOHhGXOMYApyxEj57dvqOwxAwTwPOK6tTF8t0yMVvVibVrbsZ2A/0","sourcing":null,"consume":null,"month":null,"shopOrderItems":[{"id":946,"orderId":null,"itemId":null,"itemName":"董小姐薯片","num":5,"price":90},{"id":947,"orderId":null,"itemId":null,"itemName":"卡尔顿丹麦香颂面包","num":6,"price":60},{"id":948,"orderId":null,"itemId":null,"itemName":"劲仔小鱼","num":5,"price":60},{"id":949,"orderId":null,"itemId":null,"itemName":"可口可乐","num":1,"price":90},{"id":950,"orderId":null,"itemId":null,"itemName":"瓶装雀巢咖啡","num":3,"price":220}]},{"id":"BLD20160704122922000021","totalPrice":390,"buyerId":null,"shopId":null,"buyerName":"A  郑华杰(领蛙)","shopName":null,"createdTime":1467606562000,"status":1,"headImgurl":"http://wx.qlogo.cn/mmopen/wFUHkia2T2KLH9BibhZzwHn5wDQtkynIPsArcVtG3Aawnd9ibFJoCV8hozic8LryDTnvsKjcYfORF527wBBBEib4drsoyMicsUpePq/0","sourcing":null,"consume":null,"month":null,"shopOrderItems":[{"id":943,"orderId":null,"itemId":null,"itemName":"卡尔顿丹麦香颂面包","num":5,"price":60}]}],"firstPage":1,"prePage":0,"nextPage":2,"lastPage":8,"isFirstPage":true,"isLastPage":false,"hasPreviousPage":false,"hasNextPage":true,"navigatePages":8,"navigatepageNums":[1,2,3,4,5,6,7,8]}}
        //var list=s["data"]["list"];
        var list=s.data.list;
        //buyerName:微信昵称 headImgurl：图片地址 id:列表id createdTime:创建时间 totalPrice:总价格 itemName:商品名字 price:商品价格 num:购买商品数量
        for (var i = 0; i < list.length; i++) {
            var html="";
            var buyerName = list[i].buyerName;
            var headImgurl = list[i].headImgurl;
            var id = list[i].id;
            var createdTime = list[i].createdTime;
            var totalPrice = list[i].totalPrice;
            var shop = list[i].shopOrderItems;
            html+='<div class="spending_list" id='+id+'><p class="message"><img src="'+headImgurl+'"><span>'+buyerName+'</span></p>';
            for (var j = 0; j < shop.length; j++) { 
                var itemName = shop[j].itemName;
                var price = shop[j].price;
                var num = shop[j].num;
                html+='<p class="foods"><span class="foods_01"><span class="foods_name"><span>'+itemName+'</span><span class="foods_price">￥'+price+'</span><span class="foods_num">X'+num+'</span></span></span></p>';
            }
            html+='<p class="sup"><span class="sup_list"><span>'+createdTime+'</span><span class="fr">'+totalPrice+'</span></span></p><div class="delete"><span class="del" >退款</span></div></div>';
            $(".spend_content").append(html);
        }
        $("#loading").css("display","none");
     }

 }
    document.title = "便利店列表";
    // 当输入有值的时候 x 显示出来 反之没有
    $("#sec").keyup(function(){
        var a = $(this).val();
        if (a.length>0) {
                $("#cl").css("visibility","visible");
            }else{
                $("#cl").css("visibility","hidden")
            }
        $("#cl").click(function(){
            $("#sec").val("");
            $("#cl").css("visibility","hidden");
        });  
    });
    // 点击 取消按钮出现
    $('input[name="itemName"]').click(function() {
        $('input[name="itemName"]').css("width","67%");
        $("#cancel").show();
        $('input[name="itemName"]').focus();
    });
    $("#cancel").click(function() {
        $('input[name="itemName"]').css("width","87%");
        $('input[name="itemName"]').val("");
        $("#cl").css("visibility","hidden");
        $("#cancel").hide();
    })
    $("body").css("background-color","#e8e8e8");

</script>